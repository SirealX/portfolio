---
const { pathname } = Astro.url;
const isEn = pathname.startsWith('/en');
const toggleLangPath = isEn ? pathname.replace('/en', '/es') : pathname.replace('/es', '/en');
---

<div class="flex items-center justify-between gap-3 mb-2 px-2">
  
  <div class="relative flex bg-bg-secondary/50 border border-accent/10 p-1 rounded-xl h-9 w-24 overflow-hidden shrink-0">
    <div 
      class={`absolute top-1 bottom-1 w-[calc(50%-4px)] bg-accent rounded-lg transition-all duration-300 ease-out z-0 ${isEn ? 'left-1' : 'left-[calc(50%+1px)]'}`}
    ></div>
    
    <a href={isEn ? '#' : toggleLangPath} 
       class={`relative z-10 flex-1 flex items-center justify-center text-[9px] font-black tracking-tighter transition-colors ${isEn ? 'text-bg-primary' : 'text-txt-secondary hover:text-txt-primary'}`}>
      EN
    </a>
    <a href={!isEn ? '#' : toggleLangPath} 
       class={`relative z-10 flex-1 flex items-center justify-center text-[9px] font-black tracking-tighter transition-colors ${!isEn ? 'text-bg-primary' : 'text-txt-secondary hover:text-txt-primary'}`}>
      ES
    </a>
  </div>

  <div class="flex items-center gap-3">
    <span class="text-[8px] font-black uppercase tracking-[0.2em] text-txt-secondary">Mode</span>
    <button id="theme-switch" aria-label="Toggle Theme" class="relative w-12 h-6 bg-bg-secondary border border-accent/20 rounded-full p-1 transition-all hover:border-accent/40">
      <div id="theme-knob" class="absolute left-1 top-1 w-4 h-4 rounded-full transition-all duration-300 flex items-center justify-center shadow-lg bg-accent shadow-accent/50">
        <div class="w-1 h-1 bg-bg-primary rounded-full opacity-40"></div>
      </div>
    </button>
  </div>
</div>

<script>
  const switchBtn = document.getElementById('theme-switch');
  const knob = document.getElementById('theme-knob');
  const html = document.documentElement;

  // Initialize from LocalStorage or System Preference
  const savedTheme = localStorage.getItem('theme') || 'dark';
  html.setAttribute('data-theme', savedTheme);
  updateUI(savedTheme === 'light');

  function updateUI(isLight: boolean) {
    if (knob) {
      // Move knob and change glow
      knob.style.transform = isLight ? 'translateX(24px)' : 'translateX(0)';
      // Note: Tailwind v4 handles the 'bg-accent' transition automatically via CSS variables
    }
  }

  switchBtn?.addEventListener('click', () => {
    const isNowLight = html.getAttribute('data-theme') === 'dark';
    const newTheme = isNowLight ? 'light' : 'dark';
    
    html.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
    updateUI(isNowLight);
  });
</script>