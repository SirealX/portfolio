---
import { getLangFromUrl, useTranslations } from '../../i18n/utils';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---
<div class="mt-auto flex flex-col gap-4 pt-4">
  
  <div class="relative flex-1 min-h-35 max-h-60 w-full bg-bg-secondary/40 rounded-4xl border border-accent/10 flex items-center justify-center group/mascot overflow-hidden shadow-2xl">
    
    <div class="absolute inset-0 opacity-[0.03] bg-[path('M_20_0_L_0_0_0_20')_transparent] bg-size-[20px_20px] border-accent/5"></div>
    
    <div id="eye-socket" class="relative w-16 h-16 rounded-full border-2 border-txt-secondary/20 flex items-center justify-center bg-bg-primary shadow-[inset_0_0_15px_rgba(0,0,0,0.5)]">
      
      <div id="eye-pupil" class="w-5 h-5 bg-txt-primary rounded-full shadow-[0_0_20px_rgba(var(--color-accent),0.4)] transition-transform duration-75 ease-out flex items-center justify-center">
        <div class="w-1.5 h-1.5 bg-bg-primary rounded-full"></div>
      </div>
      
    </div>

    <div class="absolute bottom-3 flex items-center gap-2">
       <span class="w-1 h-1 rounded-full bg-accent animate-pulse shadow-[0_0_8px_rgba(var(--color-accent),1)]"></span>
       <span class="text-[8px] font-black uppercase tracking-[0.3em] text-txt-secondary">{t('active')}</span>
    </div>
  </div>

  <div class="px-1">
    <div class="flex justify-between items-center mb-1">
        <span class="text-[9px] font-black uppercase tracking-[0.2em] text-txt-secondary">{t('time.Station')}</span>
        <span id="live-time" class="text-lg font-mono font-bold text-txt-primary tracking-tighter">00:00:00</span>
    </div>
    
    <div class="h-1 w-full bg-bg-secondary border border-accent/10 rounded-full overflow-hidden">
      <div id="progress-bar" class="h-full bg-accent/40 shadow-[0_0_10px_rgba(var(--color-accent),0.2)]"></div>
    </div>
  </div>
</div>

<script>
  const socket = document.getElementById('eye-socket');
  const pupil = document.getElementById('eye-pupil');
  const timeElement = document.getElementById('live-time');
  const bar = document.getElementById('progress-bar');

  document.addEventListener('mousemove', (e) => {
    if (!socket || !pupil) return;
    const rect = socket.getBoundingClientRect();
    const centerX = rect.left + rect.width / 2;
    const centerY = rect.top + rect.height / 2;
    const angle = Math.atan2(e.clientY - centerY, e.clientX - centerX);
    const distance = Math.min(15, Math.hypot(e.clientX - centerX, e.clientY - centerY) / 15);
    pupil.style.transform = `translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px)`;
  });

  function tick() {
    const now = new Date();
    if (timeElement) timeElement.innerText = now.toLocaleTimeString('en-GB', { hour12: false });
    if (bar) bar.style.width = `${(now.getSeconds() / 60) * 100}%`;
  }
  setInterval(tick, 1000);
  tick();
</script>